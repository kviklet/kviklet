name: Backend
on: [pull_request]
jobs:
  tests:
    name: Tests (${{ matrix.test-group }})
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        test-group:
          - group-1
          - group-2
          - group-3
        include:
          - test-group: group-1
            test-pattern: "**/[A-I]*"
            description: "Tests A-I"
          - test-group: group-2
            test-pattern: "**/[J-O]*"
            description: "Tests J-O"
          - test-group: group-3
            test-pattern: "**/[P-Z]*"
            description: "Tests P-Z"
    defaults:
      run:
        working-directory: ./backend
    steps:
      - uses: actions/checkout@master
      - name: Set up JDK 21
        uses: actions/setup-java@v2
        with:
          java-version: "21"
          distribution: "temurin"
      - name: Grant execute permission for gradlew
        run: chmod +x ./gradlew
      - name: Run tests for ${{ matrix.description }}
        run: ./gradlew test --tests ${{ matrix.test-pattern }} --stacktrace --info
  ktlint:
    name: Ktlint
    runs-on: ubuntu-latest
    steps:
      - name: Clone repo
        uses: actions/checkout@master
        with:
          fetch-depth: 1
      - name: ktlint
        uses: ScaCap/action-ktlint@master
        with:
          github_token: ${{ secrets.github_token }}
          reporter: github-pr-review # Change reporter
          fail_on_error: true
          ktlint_version: 1.3.0
